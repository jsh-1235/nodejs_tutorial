extends layout

block content
    p #{title}     
    hr
    //- div(class="d-flex justify-content-between")
    //-     div(class="row align-items-center")
    //-         p(id="total" class="col-sm text-center align-self-center") Hi
    //-         div(class="col-sm input-group mb-3  align-middle align-self-center")
    //-             div(class="input-group-prepend")
    //-                 span(class="input-group-text" id="basic-addon") @
    //-             input(type="text" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="basic-addon")

    //-     div(class="btn-group" role="group" aria-label="Basic example")
    //-         button(id="btnSelect" type="button" class="btn btn-primary") SELECT
    //-         button(id="btnReset" type="button" class="btn btn-secondary") RESET
    //-         button(id="btnInsert" type="button" class="btn btn-secondary") INSERT
    //-         button(id="btnClear" type="button" class="btn btn-secondary") CLEAR
    div(class="row")
        div(class="col align-self-center")
            span(id="total" class="align-middle") Total 0 / 10

        div(class="col align-self-center input-group")
                div(class="input-group-prepend")
                    span(class="input-group-text" id="basic-addon") @
                input(type="text" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="basic-addon")                

        div(class="col-md-auto btn-group" role="group" aria-label="Basic example")
            button(id="btnSelect" type="button" class="btn btn-primary") SELECT
            button(id="btnReset" type="button" class="btn btn-secondary") RESET
            button(id="btnInsert" type="button" class="btn btn-secondary") INSERT
            button(id="btnClear" type="button" class="btn btn-secondary") CLEAR 
    hr
    div
        table(class="table text-center")
            thead(class="thead-dark")
            tr
                th(scope="col") ID
                th(scope="col") Date
                th(scope="col") Serial Number
                th(scope="col") License Key
                th(scope="col") State
                th(scope="col") MAC
                th(scope="col") Settings                
            tbody(id="dynamicTbody")


block script  
    script.       
        var socket = io();

        function createTable(records) {
            if (records) {
                var html = '';

                for (key in records) {
                    html += '<tr>';
                    html += '<td class="align-middle">' + records[key].id + '</td>';
                    html += '<td class="align-middle">' + records[key].date + '</td>';
                    html += '<td class="align-middle">' + records[key].serialNumber + '</td>';
                    html += '<td class="align-middle">' + records[key].licenseKey + '</td>';
                    html += '<td class="align-middle">' + records[key].state + '</td>';
                    html += '<td class="align-middle">' + records[key].mac + '</td>';
                    html += '<td><button id="btnDelete" name="" type="button" class="btn btn-primary">DELETE</button></td>';
                    html += '</tr>';
                } 

                $("#dynamicTbody").empty();        

                $("#dynamicTbody").append(html);   
            } else {
                alert("Data is null.")

                $("#dynamicTbody").empty();
            }
        }                

        socket.on('updateDB', function (data) {
            createTable(data);

            for (var i = 0; i < data.length; i++) {
                var tr = $('#dynamicTbody').children().eq(i);

                var td = tr.children().eq(4);

                if (data[i].state == 'Register') {
                    td.css("background-color", "aqua")
                } else {
                    td.css("background-color", "white")
                }
            }

            //$("#total").text("Total : " + statistics(data) + " / " + data.length);                   

            $("#total").html("Total : "  + data.length);                   
        });

        $(document).ready(function() {
            $("#btnSelect").click(function(){                                   
                socket.emit('select', {
                    'length': 100
                });
            }); 

            $("#btnReset").click(function(){                                   
                $("#dynamicTbody").empty();
            });  

            $("#btnInsert").click(function(){                                   
                socket.emit('insert', {
                    'length': 10
                });
            });  

            $("#btnClear").click(function(){                                   
                socket.emit('clear', "clear");
            });  
        });

